#!/usr/bin/env -- ruby

require 'rubygems'
require 'sinatra'
require 'uri'
require 'json'
require './lib/findit.rb'

get '/' do
  send_file "public/nearby.html"
end

get '/findit.js' do
  send_file "public/findit.js"
end

get '/about.html' do
  send_file "public/about.html"
end

get '/svc/nearby/:lat,:lng' do |lat, lng|
  result = FindIt.nearby(lat.to_f, lng.to_f)
  content_type :json
  result.to_json
end

post '/svc/nearby' do
  a = URI.decode_www_form(request.body.read)
  lat = a.assoc('latitude').last.to_f
  lng = a.assoc('longitude').last.to_f
  result = FindIt.nearby(lat, lng)
  content_type :json
  result.to_json
end
